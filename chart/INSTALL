
echo "###### install Common "

helm repo add django https://asians-cloud.github.io/django-helm/charts/
helm repo update

ENVFILE=/tmp/.uat.env.json
kubectl get configmaps gaius-uat-env -o jsonpath='{.data.\.uat\.env\.json}' > $ENVFILE
j2 -f json env.yaml.j2 $ENVFILE -o env.yaml
rm $ENVFILE

common_release="${COMMON_RELEASE_NAME:-gaius-uat-common}"

if [[ "${INSTALL_OR_UPGRADE}" == "INSTALL" ]]
then
  helm delete "$common_release"

  helm install "$common_release" -f ./env.yaml django/django-django
else
  helm upgrade "$common_release" -f ./env.yaml django/django-django
fi
